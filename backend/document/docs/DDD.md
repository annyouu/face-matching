# DDDとは？
DDDは、「技術」ではなく、「業務 (ドメイン)」を中心にソフトウェア設計をする手法のこと。

# DDDの思想
### DDD専用の用語について

#### ① ユビキタス言語
エンジニアとビジネスサイド(企画者など)が「共通の言葉」を使うこと。コードの中の変数名と企画書の中の言葉を完全に一致させるための言語。

ユーザーがマッチングした時、、、、
これをコード上でもUserクラス、Match()メソッドと名付ける。

#### ② 境界づけられたコンテキスト (Bounded Context)
言葉の意味が通じる「範囲」を明確に区切ること。巨大なシステムでは、同じProductという言葉でも、部署によって意味が変わってくる。

- ECサイトの例：
    - 配送担当にとっての「商品」：重さ、サイズ、在庫場所が重要になる。
    - 販売担当にとっての「商品」：価格、説明文、セール期間が重要になる。

人によって商品の解釈が異なる。
これをDDDは、無理に1つのProductクラスにまとめることはせず、「配送コンテキストのProduct」と「販売コンテキストのProduct」を別々のクラスとして作る。


# DDDの実装部分
DDDで実装する部品のこと

① エンティティ (Entity)
IDで区別されるオブジェクトのこと。中身のデータが変わっても、IDが同じなら同じものとして扱う。

例：
Userの名前を変えたとしても、IDが123ならそれは同じユーザーである。

② 値オブジェクト (Value Object)
値そのもので区別されるオブジェクト。不変であり、値を変更するときは新しいオブジェクトを作る。

例：1万円
金は、製造番号IDや1万円というお金としての価値(Value)がある。

#### エンティティ(識別が必要なもの)：通帳、口座

- 銀行口座
    - ID：口座番号
    - Value：残高 (1万円、10万円)

残高が1万円から10万円に変わっても、その口座番号は同じである。識別子があるからこそどの口座かが分かる。

#### 値オブジェクト (識別が不要なもの)：お金の価値

- 1万円という価値
    - Aさんが、財布C,Dを持っている時、Cに入っている1万円をDに移しても、Aの資産価値は変わらない。
    - システム上で1万を支払う場合、その1000がどの製造番号のお札かまでをシステムが知る必要はない。あくまで、お金の価値が1万ですよという価値のみを知っていればいい。つまり、IDが不要で値の価値(1万、10万)で区別が行えるということ。

③ 集約 (Aggregate)
必ず整合性を保ちたいデータの塊のこと。トランザクションで一単位になる。

- 例：Order(注文)とOrderItem(注文明細)
    - 注文明細だけを勝手にDBに保存して、親の注文が存在しないという状況は許されない。
    - 必ずOrderを通してOrderItemを操作するように制限する。

④ リポジトリ (Repository)
集約を保存したり、取り出したりするDBの永続化処理をinterfaceで抽象化する役割。

⑤ ドメインサービス (Domain Service)
モノ (Entity/Value Object)に持たせるには不自然な「操作、アクション」を引き受ける場所のこと。

例：送金処理
銀行口座Aが、口座Bに送信するとなってしまっている場合、
口座自体が他の口座に送信するのは役割を持ちすぎ。口座はあくまで口座番号という識別子といくらお金があるかという価値の情報を持っているだけのオブジェクトとしての役割のみを持つべき。

ここで、「ドメインサービス」を活用して送信サービスという一つの処理として切り離す。
これによって、「送信サービスが、口座AからBへ送金を実行する」という口座(エンティティ)と送金処理(ドメインサービス)という切り分けをうまく行える。


# 今回の顔認証でDDDをどのように組み込むか
3つのステップでやるべきことを進めていく。
### ① ユビキタス言語の確立
開発チーム全体で使う専門用語を明確にし、コードに落とし込む。
コードに落とし込んだ言葉で統一する。会話に齟齬がないようにする。

今回の例：
顔の特徴量ベクトルをコードでは常にFaceEmbeddingと呼ぶ。
同一性判定をcalculateSimilarityと呼ぶなど。

### ② ドメインオブジェクトの特定と分類
認識を揃えたユビキタス言語からアプリケーションの主要な要素を「エンティティ」「値オブジェクト」「ドメインサービス」に分類する。

- エンティティ：IDの識別子で区別が行えるもの

例：
User (ユーザーIDで識別される)
FaceRegistration (登録IDで識別される)
顔登録は、顔特徴量があるので、値オブジェクトとして処理をするということではないの？

- 値オブジェクト：IDが不要で値のみで判別が行えるもの

例：
FaceEmbedding(ベクトル量)など

- ドメインサービス：ものに持たせるには不自然な操作を担う処理のこと
例：
FaceRecognitionService (類似度計算、登録済みユーザーとのマッチング)など
これは、他の値オブジェクトに組み込むには不自然で、役割は過剰になる可能性が高い。
なので、ドメインサービスとして一つの処理に切り分ける。

### ③ アーキテクチャの定義 (DDDの基本アーキテクチャ構成について)

- ユーザーインターフェース (UI) / プレゼンテーション (Presentation)
    - controllerとも自分は認識をしている。
- アプリケーション (Application)
    - ユースケース(ビジネスロジック)を実行する層。
- ドメイン (Domain)
    - ビジネスルールのすべて。エンティティ、値オブジェクト、ドメインサービスが配置される。他の層への依存はしない。
- インフラストラクチャ (Infrastructure)
    - 外部技術とのやり取りを行う。

DDDの4層で何をすべきか(ドメイン)を定義し、
ここからさらに、長期的な拡張性、保守性のために、
クリーンアーキテクチャを活用しその層をどのように配置し、どのように依存させるかという構造と規則への肉付けを行なっていく。

