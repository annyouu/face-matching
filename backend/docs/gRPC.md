# gRPCとは？
gRPCはオープンソースのHTTP/2を採用したRPCフレームワークである。Googleによって開発され、2015年にオープンソースとして公開された。

# RPC(Remote Procedure Call)とは？
環境が違う別サーバーある関数を、自分のローカル関数みたいに呼び出せる通信方式のこと。

# gRPCは、なぜHTTP/2を採用しているのか？
- バイナリ形式と相性がいいから。
    - HTTP/2は、バイナリフレーム構造を持つ。gRPCのIDLのための、Protocol Buffersもバイナリ形式を採用しているため。
- 双方向通信が必須だから。
    - gRPCは関数呼び出しをネットワーク越しに高速で行う技術のこと。
    - クライアント → サーバ、サーバ → クライアントの両方向同時ストリーミングが必要になる。

# HTTPについて(HTTP/1.1からHTTP/2の移行)

## HTTP/1.1
課題：従来のHTTPでは、1回の送受信ごとに新しいコネクションを確立する必要があり、ページがリッチ化すると通信が遅く高負荷になる。

そこの改善点として、HTTP/1.1での「Keep-Alive」と「パイプライニング」が出る。
- Keep-Alive
    - 1つのコネクションで複数回の送受信を可能にする
    - 接続の再確立コストを削減する
- パイプライニング
    - 前のリクエストが完了する前に次のリクエストを送信可能
    - 並列っぽく見えるけど、実際は順番待ちが発生する古い技術

### 仕組み
ブラウザはレスポンスを待たずに次のリクエストを送ることができる
→ 送信だけ同時に行うことができる
しかしレスポンスは順番通りにしか返せない。この問題解消にHTTP/2が登場した。

## HTTP/2
本当に並列になる。1つの通信路で大量のリクエストが同時に流れる。

### 仕組み
1コネクションの中を「ストリーム (複数の独立した流れ)」に分ける。各ストリームは完全に独立して並行実行する。
→ 各リクエストが独立して処理される。リスクストも複数同時に扱える。

1. マルチプレキシング
    - 1つのTCP接続で複数リクエスト/レスポンスを同時処理する。
    - パイプライニング → マルチプレキシングになった
2. バイナリ通信
    - 文字列 → バイナリで通信効率が上がり、解析も高速になる
3. ヘッダ圧縮
    - 送信データ量を大幅削減できる
4. サーバプッシュ
    - クライアントが要求する前に必要リソースを送信することができる

### バイナリ形式について
- 「数字の羅列」ではなく、2進数の構造化されたパケットということ。
    - テキストのように1文字ずつ解析は必要なくなった。
    - コンピュータが理解しやすく、処理がより軽く、速くなる。

# 今回採用するとどういう強みがあるの？
1. 大量データを効率的に転送できる
    - 顔埋め込みは512次元float32の配列になる。
    - これをJSONや文字列形式で扱うと、処理が重い。
    - gRPCではバイナリ形式になるので、通信量が少なく、高速に転送が可能になる。

2. GoとPythonで型安全を保証したやり取りができる
    - Go側でembeddingを受け取って類似度計算をする。
    - 型が保証されているので、型のミスマッチがない。
    - この型の保証は、protoが行ってくれる

3. 将来の展望で双方向ストリーミング、非同期通信が容易になる
    - 今は「1画像 → 1embedding → 1レスポンス」だけだが、将来的に複数画像を送信したいとなった時、HTTP/2のマルチプレキシングを使用しているので、容易に拡張が可能。


